{% load custom_tags %}

<div id="display-records" class="w-full overflow-scroll">

    <h3 class="mt-4 mb-4 text-xl font-bold leading-6 text-center text-theme">Bảng dự toán vật tư</h3>

    <div class="h-full">
        {% csrf_token %}
        <div class="flex flex-col h-full justify-between gap-5 text-sm text-theme">
            <div class="flex flex-col h-fit h-max-[300px] gap-4 pt-4 pb-2 overflow-y-scroll">

                <div class="flex flex-col justify-center gap-5">
                    <div class="flex justify-center gap-5">

                        <form up-target="#modal:maybe, #display-records, #tool-bar" action="{% url 'form_cost_estimation_table' project_id=project_id %}" method="post"
                            enctype="multipart/form-data" id="upload-form"
                            class="flex flex-row whitespace-nowrap gap-2">
                            {% csrf_token %}
                            <input type="file"
                                class="form-input-file file-input file-input-bordered w-full max-w-xs" id="file"
                                name="file" accept=".xlsx" required onchange="checkFileSize(this.files[0])" />
                            <input type="hidden" name="project" value="{{ project_id }}">
                            <button class="btn btn-primary" id="upload-button">
                                <i class="fas fa-file-excel me-3" style="font-size: 16px;"
                                    aria-hidden="true"></i>
                                <span class="me-3"> Nhập File Excel </span>
                            </button>
                        </form>


                        <!-- download_backup.html -->
                        <a href="{% url 'download_excel_template' 'cost_estimation_table' %}?project_id={{ project_id }}"
                            class="whitespace-nowrap">
                            {% csrf_token %}
                            <button class="btn btn-primary nowrap">
                                <i class="fas fa-file-excel me-3" style="font-size: 16px;"
                                    aria-hidden="true"></i>
                                <span class="me-3"> Tải mẫu excel </span>
                            </button>
                        </a>

                        <a id="create-new" href="{% url 'load_elements' %}?q={% encode_params model=model check_date=check_date project_id=project_id elements='modal_form' %}" up-preload="insert" up-target="#modal" class="btn btn-primary text-nowrap">
                            <i class="fas fa-plus me-3" style="font-size: 16px;"></i>
                            <span class="me-3"> Thêm dự toán </span>
                        </a>
                 
                    </div>

                    {% if message %}
                        <div id="message-in-modal" class="w-full text-center">
                            <span class="inline-flex items-center pl-4 pr-1 py-1 bg-{{ message_type }}-100 text-{{ message_type }}-700 rounded-full text-sm font-medium">
                                {{ message }}
                                <button type="button" class="btn btn-secondary rounded-full text-nowrap h-6 w-6 text-sm ms-3"
                                        onclick="document.getElementById('message-in-modal').remove()" >
                                    <i class="fas fa-times" aria-hidden="true"></i>
                                </button>
                            </span>
                        </div>
                    {% endif %}
                    
                    <!-- Material Type Filter Tabs -->
                    <div class="tabs-container mb-4">
                        <div class="flex flex-wrap justify-center gap-2 mb-2">
                            <button class="material-tab btn btn-sm btn-outline active" data-filter="all">Tất cả vật tư</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư thông thường">Vật tư thông thường</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư sắt thép">Vật tư sắt thép</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư cát, đá, xi măng">Vật tư cát, đá, xi măng</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư bê tông">Vật tư bê tông</button>
                        </div>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư nhựa">Vật tư nhựa</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư điện">Vật tư điện</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư nước">Vật tư nước</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Cây xanh">Cây xanh</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư đặc thù">Vật tư đặc thù</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư biển báo, cọc tiêu, cơ khí">Vật tư biển báo, cọc tiêu, cơ khí</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư phụ/ Biện pháp thi công">Vật tư phụ/ Biện pháp thi công</button>
                            <button class="material-tab btn btn-sm btn-outline" data-filter="Vật tư gồm nhân công thi công">Vật tư gồm nhân công thi công</button>
                        </div>
                    </div>

                    <div class="w-full overflow-scroll">
                        <table id="cost-estimation-table"
                            class="table-auto w-full overflow-hidden border border-slate-300 dark:border-slate-900 border-opacity-50 rounded-2xl shadow-md">
                            {% if not update %}
                            <thead>
                                <tr class="text-sm leading-normal text-theme rounded-2xl shadow-md bg-white dark:bg-slate-800
                                border border-slate-300 dark:border-slate-900 border-opacity-50">
                                    {% for header in headers %}
                                    <th class="px-6 py-3 text-left font-semibold">{{ header }}</th>
                                    {% endfor %}

                                </tr>
                                {% endif %}

                            </thead>
                            {% for record in records %}
                            <tbody>
                                <tr
                                    class="{{ record.style }} bg-gray-50 hover:bg-blue-100 dark:bg-gray-800 dark:even:bg-gray-700 dark:hover:bg-gray-600">
                                    {% for field in fields %}
                                    <td
                                        class="px-6 py-3 border-b border-gray-200 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-300">
                                        {{ record|format_display:field }}
                                    </td>
                                    {% endfor %}

                                </tr>

                            </tbody>
                            {% endfor %}
                        </table>
                    </div>


                </div>

            </div>
        </div>
    </div>
</div>
<div id="tool-bar">

</div>