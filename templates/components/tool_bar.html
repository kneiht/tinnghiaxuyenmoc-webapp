{% load custom_tags %}

<div id="tool-bar" class="flex flex-row justify-between items-end w-full gap-5">
    <!-- Toolbar for database interactions -->
    <div class="flex flex-row items-end gap-5">
       
        <form action="{% url 'load_elements' %}" up-target="#display-records, #lazy-load:maybe">
            <input type="hidden" name="q" value="{% encode_params model=model check_date=check_date project_id=project_id start_date=start_date group_by=group_by tab=tab  elements='display_records|tool_bar' %}" />
            <input type="hidden" name="check_date" value="{{ check_date }}" />
            <!-- Separate 2 sections of controls -->
            <div class="flex flex-wrap justify-between gap-4">
                <!-- Left controls for filtering and sorting -->
                <div id='left-controls' class="flex justify-start gap-4 h-10 w-fit">

                    <!-- Controls to manage search and filter options -->
                    <div id="search-control" class="z-10 w-full flex flex-row justify-between items-center gap-4">

                        <!-- Toggle search bar in small screen
                        <button id="toggle-search" type="button" class="btn btn-outline h-full w-11 sm:hidden">
                            <i class="fas fa-search text-theme" style="font-size: 18px;"></i>
                        </button> -->

                        <!-- Search bar and filter options -->
                        <div id="search-bar" class="flex h-10 w-[500px]">
                            <!-- Input field for filter values -->
                            <input id="filter-input" name="all" type="text" placeholder="Nhập để tìm kiếm ..."
                                class="form-input rounded-l-lg rounded-r-none h-full border-r-0 border-theme dark:border-gray-600 border-opacity-50 text-theme"
                                autocomplete="off"/>
                            <!-- Button to submit search -->
                            <button id="search-button"
                                class="btn btn-outline rounded-l-none h-full shadow-none">
                                <i class="fas fa-search text-theme" style="font-size: 18px;"></i>
                            </button>
                        </div>

                        {% if page == 'page_each_project' %}
                        <select id="sort-select" name="sort" class="form-input w-fit border-theme dark:border-gray-600 border-opacity-50">
                            <option value="" selected>Sắp xếp ...</option>
                            <option value="name">Tên công việc - (A → Z)</option>
                            <option value="-name">Tên công việc - (Z → A)</option>
                            <option value="category">Danh mục - (A → Z)</option>
                            <option value="-category">Danh mục - (Z → A)</option>
                            <option value="status">Trạng thái</option>
                            <option value="unit">Đơn vị - (A → Z)</option>
                            <option value="-unit">Đơn vị - (Z → A)</option>
                            <option value="quantity">Khối lượng - (Tăng)</option>
                            <option value="-quantity">Khối lượng - (Giảm)</option>
                            <option value="unit_price">Đơn giá - (Tăng)</option>
                            <option value="-unit_price">Đơn giá - (Giảm)</option>
                            <option value="total_amount">Thành tiền - (Tăng)</option>
                            <option value="-total_amount">Thành tiền - (Giảm)</option>
                            <option value="start_date">Ngày bắt đầu - (Tăng)</option>
                            <option value="-start_date">Ngày bắt đầu - (Giảm)</option>
                            <option value="end_date">Ngày kết thúc - (Tăng)</option>
                            <option value="-end_date">Ngày kết thúc - (Giảm)</option>
                        </select>
                        
                        <script>
                            document.getElementById('sort-select').addEventListener('change', function() {
                                // Press search-button
                                document.getElementById('search-button').click();
                            });
                        </script>

                        {% elif page == 'page_transport_department' and model == 'VehicleMaintenance' %}
                        <select id="sort-select" name="sort" class="form-input w-fit border-theme dark:border-gray-600 border-opacity-50">
                            <option value="-created_at" selected>Ngày tạo phiếu (gần nhất trước)</option>
                            <option value="repair_code">Mã phiếu - (A → Z)</option>
                            <option value="-repair_code">Mã phiếu - (Z → A)</option>
                            <option value="from_date">Ngày nhận sửa chữa - (xa nhất trước)</option>
                            <option value="-from_date">Ngày nhận sửa chữa - (gần nhất trước)</option>
                        </select>
                        
                        <script>
                            document.getElementById('sort-select').addEventListener('change', function() {
                                // Press search-button
                                document.getElementById('search-button').click();
                            });
                        </script>

                        {% elif model == 'FuelFillingRecord' or model == 'LubeFillingRecord' or model == 'FillingRecord' %}
                        <select id="sort-select" name="sort" class="form-input w-fit border-theme dark:border-gray-600 border-opacity-50">
                            <option value="-fill_date" selected>Ngày đổ (gần nhất trước)</option>
                            <option value="fill_date">Ngày đổ (xa nhất trước)</option>
                        </select>

                        <script>
                            document.getElementById('sort-select').addEventListener('change', function() {
                                // Press search-button
                                document.getElementById('search-button').click();
                            });
                        </script>

                        {% elif model == 'PaymentRecord' %}
                        <select id="sort-select" name="sort" class="form-input w-fit border-theme dark:border-gray-600 border-opacity-50">
                            <option value="" selected>Mặc định - (Mã sửa chữa)</option>
                            <option value="status">Trạng thái thanh toán  - (A → Z)</option>
                            <option value="-status">Trạng thái thanh toán  - (Z → A)</option>
                            <option value="provider">Nhà cung cấp  - (A → Z)</option>
                            <option value="-provider">Nhà cung cấp  - (Z → A)</option>
                            <option value="-requested_date">Ngày đề nghị  - (gần nhất trước)</option>
                            <option value="requested_date">Nhà cung cấp  - (xa nhất trước)</option>
                            <option value="-payment_date">Ngày thanh toán  - (gần nhất trước)</option>
                            <option value="payment_date">Nhà thanh toán  - (xa nhất trước)</option>

                        </select>

                        <script>
                            document.getElementById('sort-select').addEventListener('change', function() {
                                // Press search-button
                                document.getElementById('search-button').click();
                            });
                        </script>


                        {% elif model == 'PaymentRecord' %}
                        <select id="sort-select" name="sort" class="form-input w-fit border-theme dark:border-gray-600 border-opacity-50">
                            <option value="" selected>Mặc định - (Mã sửa chữa)</option>
                            <option value="status">Trạng thái thanh toán  - (A → Z)</option>
                            <option value="-status">Trạng thái thanh toán  - (Z → A)</option>
                            <option value="provider">Nhà cung cấp  - (A → Z)</option>
                            <option value="-provider">Nhà cung cấp  - (Z → A)</option>
                            <option value="-requested_date">Ngày đề nghị  - (gần nhất trước)</option>
                            <option value="requested_date">Nhà cung cấp  - (xa nhất trước)</option>
                            <option value="-payment_date">Ngày thanh toán  - (gần nhất trước)</option>
                            <option value="payment_date">Nhà thanh toán  - (xa nhất trước)</option>

                        </select>

                        <script>
                            document.getElementById('sort-select').addEventListener('change', function() {
                                // Press search-button
                                document.getElementById('search-button').click();
                            });
                        </script>




                        {% elif page == 'page_transport_department' and tab == 'vehicle_operation_data_by_date' %}
                            <input id="start_date" type="date" name="start_date" value="{{ start_date }}" class="form-input w-fit">
                            <script>
                                document.getElementById('start_date').addEventListener('change', function() {
                                    // Press search-button
                                    document.getElementById('search-button').click();
                                });
                            </script>
                        {% elif page == 'page_transport_department' and tab == 'driver_salary' %}
                                <input id="check_month" type="month" name="check_month" value="{{ check_month }}" class="form-input w-fit">
                                <script>
                                    document.getElementById('check_month').addEventListener('change', function() {
                                        // Press search-button
                                        document.getElementById('search-button').click();
                                    });
                                </script>

                        {% elif page == 'page_transport_department' and tab == 'vehicle_revenue' %}
                            <input id="start_date" type="date" name="start_date" value="{{ start_date }}" class="form-input w-fit">
                            <span class="text-lg text-theme">đến</span>
                            <input id="end_date" type="date" name="end_date" value="{{ end_date }}" class="form-input w-fit">
                                <script>
                                    document.getElementById('start_date').addEventListener('change', function() {
                                        // Press search-button
                                        document.getElementById('search-button').click();
                                    });
                                    document.getElementById('end_date').addEventListener('change', function() {
                                        // Press search-button
                                        document.getElementById('search-button').click();
                                    });
                                </script>
                        {% endif %}

                        
                    </div>
                    <div id="current-filter" class="form-input text-sm flex flex-nowrap items-center gap-2 hidden text-nowrap">
                        <span class="text-theme" id="current-filter-text"></span>
                        <button type="button" class=" text-red-500" id="clear-filter" 
                            onclick="
                                document.getElementById('current-filter-text').innerHTML='';
                                document.getElementById('current-filter').classList.add('hidden');
                                document.getElementById('search-button').click();">
                            <i class="fas fa-times mt-1" style="font-size: 23px;"></i>
                        </button>
                    </div>

                    {% if model == 'PaymentRecord' %}
                    <div id="extra-info" class="extra-info flex flex-nowrap items-center gap-2 text-nowrap"></div>
                    <script>totalRequestedAmountDisplay();</script>
                    {% endif %}

                </div>
                {% if page == 'page_transport_department' and tab == 'vehicle_revenue' %}
                <div class="flex justify-items-center gap-2 items-center h-10 text-center">
                    <div id="total-revenue" class="inline-flex items-center h-full px-4 py-1 bg-green-100 text-green-700 rounded-lg text-sm font-medium text-nowrap">Tổng Doanh thu:</div>
                    <div id="total-interest" class="inline-flex items-center h-full px-4 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium text-nowrap">Tổng lợi nhuận:</div>
                </div>
                {% endif %}
            </div>
        </form>
        <!-- Right controls for view toggle and information display -->
        {% if page == 'page_each_project' and model == "Job" %}
        <form action="{% url 'load_elements' %}" up-target="#display-records">
            <input type="hidden" name="q" value="{% encode_params model=model check_date=check_date project_id=project_id elements='display_records' %}" />
            <div class="flex flex-wrap items-end justify-between gap-4">
                <input type="hidden" name="check_date" value="{{ check_date }}" />
                <button type="submit" class="btn btn-outline">
                    <input type="submit" name="all" value=""/>
                    Tất cả công việc
                </button>
                <!-- Separate 2 sections of controls -->
            </div>
            <input name="archived" id="archived" value="false" class="hidden">
        </form> 
        {% endif %}
    </div>
    
    <div class="flex flex-row items-end gap-5">

        {% if page == 'page_each_project' and model == "Job" %}
        <button id="excel-button" class="btn btn-primary text-nowrap" id="toggle-extra-tool-bar" onclick="var x = document.getElementById('extra-tool-bar'); x.classList.toggle('hidden');">
            <i class="fas fa-file-excel me-3" style="font-size: 16px;" aria-hidden="true"></i>
            <span class="me-3"> Excel </span>
        </button>
        {% endif %}

        {% if create_new_button_name and model != "PaymentRecord" %}
        <a id="create-new" href="{% url 'load_elements' %}?q={% encode_params model=model check_date=check_date project_id=project_id elements='modal_form' %}" up-preload="insert" up-target="#modal" class="btn btn-primary text-nowrap">
            <i class="fas fa-plus me-3" style="font-size: 16px;"></i>
            <span class="me-3"> {{ create_new_button_name }} </span>
        </a>
        {% endif %} 

        <!-- {% if display_trashcan %}
        <button id="archived-items" class="btn btn-outline text-nowrap" onclick="
            var archivedInput = document.getElementById('delete');
            var createNewButton = document.getElementById('create-new');
            var searchButton = document.getElementById('search-button');
            archivedInput.value = archivedInput.value === 'true' ? 'false' : 'true';
            this.classList.toggle('btn-outline');
            this.classList.toggle('btn-success');
            this.querySelector('span').innerText = this.querySelector('span').innerText === 'Thùng rác (tắt)' ? 'Thùng rác (bật)' : 'Thùng rác (tắt)';
            createNewButton.classList.toggle('hidden');
            searchButton.click();
        ">
            <i class="fas fa-trash-can me-3" style="font-size: 16px;"></i>
            <span class="me-3"> Thùng rác (tắt) </span>
        </button>
        {% endif %} -->
    </div>

</div>

{% if page == 'page_each_project' %}
<div id="extra-tool-bar" class="flex justify-center hidden">
    <div class="hidden" id="project-id" data-id="{{ project_id }}"></div>
    <div class="card w-fit p-5 mb-4 flex flex-row justify-center items-center gap-4">

        <form up-target="#display-records:maybe" action="{% url 'upload_project' project_id %}" method="post" enctype="multipart/form-data" id="upload-form"
            class="flex flex-row whitespace-nowrap gap-2">
            {% csrf_token %}
            <input type="file" class="form-input-file file-input file-input-bordered w-full max-w-xs" id="file" name="file"
                accept=".xlsx" required onchange="checkFileSize(this.files[0])" />
            <input type="hidden" name="project" value="{{ project_id }}">
            <button class="btn btn-primary" id="upload-button">
                <i class="fas fa-file-excel me-3" style="font-size: 16px;" aria-hidden="true"></i>
                <span class="me-3"> Nhập File Excel </span>
            </button>
        </form>


        <!-- download_backup.html -->
        <a href="{% url 'download_excel_template' 'jobs' %}"  class="whitespace-nowrap">
            {% csrf_token %}
            <button class="btn btn-primary">
                <i class="fas fa-file-excel me-3" style="font-size: 16px;" aria-hidden="true"></i>
                <span class="me-3"> Tải mẫu excel </span>
            </button>
        </a>

        <button class="btn btn-secondary ml-5" onclick="var x = document.getElementById('extra-tool-bar'); x.classList.add('hidden');">
            <span class=""> Đóng </span>
        </button>

    </div>

</div>
{% endif %}