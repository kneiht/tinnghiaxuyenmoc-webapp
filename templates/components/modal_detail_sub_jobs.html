{% load static %}
{% load custom_tags %}

<div id="modal-detail-sub-jobs" class="modal-container">
    <div class="modal-content w-full max-w-4xl">
        <div class="modal-header">
            <h2 class="text-xl font-semibold">Chọn công việc chi tiết</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="mb-4">
                <label for="SubContractor-filter" class="block text-sm font-medium text-gray-700">Lọc theo tổ đội/nhà thầu phụ:</label>
                <select id="SubContractor-filter" class="form-input">
                    <option value="">Tất cả</option>
                    {% for SubContractor in SubContractors %}
                    <option value="{{ SubContractor.id }}">{{ SubContractor.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Tổ đội/Nhà thầu phụ
                            </th>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Mã công việc
                            </th>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Tên đầy đủ
                            </th>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Đơn giá
                            </th>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Ngày áp dụng
                            </th>
                            <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Thao tác
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sub_job in sub_jobs %}
                        <tr class="hover:bg-gray-100 sub-job-row" data-SubContractor-id="{{ sub_job.sub_contractor.id }}">
                            <td class="py-2 px-4 border-b border-gray-200">{{ sub_job.sub_contractor.name }}</td>
                            <td class="py-2 px-4 border-b border-gray-200">{{ sub_job.job_number }}</td>
                            <td class="py-2 px-4 border-b border-gray-200">{{ sub_job.job_name }}</td>
                            <td class="py-2 px-4 border-b border-gray-200">{{ sub_job.sub_job_price|format_currency }}</td>
                            <td class="py-2 px-4 border-b border-gray-200">{{ sub_job.valid_from|date:"d/m/Y" }}</td>
                            <td class="py-2 px-4 border-b border-gray-200">
                                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded select-detail-sub-job" 
                                        data-id="{{ sub_job.id }}" 
                                        data-job-number="{{ sub_job.job_number }}" 
                                        data-job-name="{{ sub_job.job_name }}" 
                                        data-price="{{ sub_job.sub_job_price }}">
                                    Chọn
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="close-modal bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                Đóng
            </button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const SubContractorFilter = document.getElementById('SubContractor-filter');
        const subJobRows = document.querySelectorAll('.sub-job-row');

        SubContractorFilter.addEventListener('change', function() {
            const selectedSubContractorId = this.value;
            
            subJobRows.forEach(row => {
                if (!selectedSubContractorId || row.dataset.sub_contractorId === selectedSubContractorId) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    });
</script>
